<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tomcat Connector &#8212; realHTML4Natural 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Webserver" href="webserver.html" />
    <link rel="prev" title="Build process and Installation" href="installation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tomcat-connector">
<span id="id1"></span><h1>Tomcat Connector<a class="headerlink" href="#tomcat-connector" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>When you want to use the framework with a new or current tomcat installation you can use the <a class="reference external" href="https://github.com/audacity363/realHTML_TomcatConnector">TomcatConnector</a>. It consists of three parts:</p>
<ul class="simple">
<li>A tomcat servlet which handles the requests</li>
<li>A library which provides helper function for the servlet</li>
<li>A JNI (Java Native Interface) Library which calls Natural</li>
</ul>
<img alt="_images/tomcat_connector.png" src="_images/tomcat_connector.png" />
<div class="section" id="tomcat-servlet">
<h3>Tomcat Servlet<a class="headerlink" href="#tomcat-servlet" title="Permalink to this headline">¶</a></h3>
<p>The purpose of the tomcat servlet is to handle the incoming request, get the configuration and call Natural.
You have to put the .class file which is located in the servlet folder into your webapps folder under &#8220;ROOT/WEB-INF/classes&#8221;. When one of the folder does not exist you can just create it.</p>
<p>To get the servlet to get known from the tomcat you have to edit your web.xml configuration file. It should be located in your &#8220;conf&#8221; folder in your tomcat installation directory. Just add the following at the end:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>realHTMLServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>realHTMLServlet<span class="nt">&lt;/servlet-class&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>

<span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>realHTMLServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/realHTML4Natural/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/servlet-mapping&gt;</span>
</pre></div>
</div>
<p>The servlet tag is there for getting to know the java class (located in the servlet-class tag) of the servlet to the tomcat. With the servlet-name tag under servlet you give the servlet a name for later configuration.</p>
<p>With the servlet-mapping tag you map the servlet to a specific path. In your case every url with &#8220;/realHTML4Natural/&#8221; at the beginning will call the servlet.</p>
</div>
<div class="section" id="servlet-library">
<h3>Servlet Library<a class="headerlink" href="#servlet-library" title="Permalink to this headline">¶</a></h3>
<p>The library you can find in the &#8220;realHTML/tomcat/connector&#8221; library. In there you find utility function for parsing the xml configuration files (see section &#8220;Connector configuration&#8221;), the loading of the JNI library and the call to the C-function in the JNI library. This jar file must be placed in the &#8220;lib&#8221; folder of your tomcat installation.</p>
<p>Why is this so?</p>
<p>A JNI library can only loaded once in one Java VM. Because the servlets runs in threads you are allowed to load her once. The jar files in the lib directory gets loaded on the start up process of the tomcat and so gets the JNI library loaded and you can use the functions in a servlet.</p>
</div>
<div class="section" id="jni-library">
<h3>JNI library<a class="headerlink" href="#jni-library" title="Permalink to this headline">¶</a></h3>
<p>In the JNI library happens all the magic. Here the parameter for the natural gets generated, a new process gets spawned  and natural runs in this process. The library now waits until this process has exited and returns to the servlet.</p>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>The installation is rather simple:</p>
<ul class="simple">
<li>run the Makefile with the target &#8220;all&#8221;</li>
<li>copy realHTMLconnector.jar into the lib directory of your tomcat installation</li>
<li>copy the *.class file into &#8220;&lt;path to your webapps folder&gt;/ROOT/WEB-INF/classes/&#8221;</li>
<li>copy the librealHTMLconnector.so into a folder that you choose</li>
<li>edit the tomcat web.xml as show in <a class="reference internal" href="#tomcat-servlet">Tomcat Servlet</a></li>
<li>edit your setenv.sh in the bin directory and add the following lines:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">realHTMLconfiguration</span><span class="o">=</span>&lt;path to your config file <span class="k">for</span> the framework&gt;
<span class="nb">export</span> <span class="nv">NATUSER</span><span class="o">=</span><span class="nv">$NATUSER</span>:&lt;path to your ralHTMLNatural.so&gt;
<span class="nb">export</span> <span class="nv">LIBPATH</span><span class="o">=</span><span class="nv">$LIBPATH</span>:&lt;path to the directory where your libnatural.so lies&gt;
</pre></div>
</div>
<ul class="simple">
<li>edit your catalina.sh in the bin directory and search for a line where the variable &#8220;JAVA_OPTS&#8221; get set.</li>
<li>append it with the &#8220;-Djava.library.path=&lt;path to the directory which contains the JNI library&gt;&#8221;. For example:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">JAVA_OPTS</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$JAVA_OPTS</span><span class="s2"> </span><span class="nv">$JSSE_OPTS</span><span class="s2"> -Djava.library.path=/realHTML4Natural/bin/&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>restart tomcat</li>
</ul>
</div>
<div class="section" id="connector-configuration">
<h2>Connector configuration<a class="headerlink" href="#connector-configuration" title="Permalink to this headline">¶</a></h2>
<p>The path to this file is stored in the environment variable &#8220;realHTMLconfiguration&#8221;. It can contain multiple environments. For example a configuration for multiple natural environments with different parm files.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;realHTML4Natural&gt;</span>
    <span class="nt">&lt;environment</span> <span class="na">type=</span><span class="s">&quot;env1&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;routes&gt;</span>/realHTML4Natural/env1/routes.xml<span class="nt">&lt;/routes&gt;</span>
        <span class="nt">&lt;templates&gt;</span>/realHTML4Natural/env1/templates/<span class="nt">&lt;/templates&gt;</span>
        <span class="nt">&lt;natparms&gt;</span>parm=env1parm etid=$$<span class="nt">&lt;/natparms&gt;</span>
        <span class="nt">&lt;natsourcepath&gt;</span>/realHTML4Natural/natural/env1/fuser63/<span class="nt">&lt;/natsourcepath&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
    <span class="nt">&lt;environment</span> <span class="na">type=</span><span class="s">&quot;env2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;routes&gt;</span>/realHTML4Natural/env2/routes.xml<span class="nt">&lt;/routes&gt;</span>
        <span class="nt">&lt;templates&gt;</span>/realHTML4Natural/env2/templates/<span class="nt">&lt;/templates&gt;</span>
        <span class="nt">&lt;natparms&gt;</span>parm=env2parm etid=$$<span class="nt">&lt;/natparms&gt;</span>
        <span class="nt">&lt;natsourcepath&gt;</span>/realHTML4Natural/natural/env2/fuser63/<span class="nt">&lt;/natsourcepath&gt;</span>
    <span class="nt">&lt;/environment&gt;</span>
<span class="nt">&lt;/realHTML4Natural&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="explanation-enviroment-tag">
<h3>Explanation enviroment tag<a class="headerlink" href="#explanation-enviroment-tag" title="Permalink to this headline">¶</a></h3>
<p>With the environment tag you can setup multiple environments on which the servlet should listen. It takes exactly one argument. The type attribute with the name of the environment.  The url entry after &#8220;realHTML4Natural&#8221; specify the enviroment to call. For example &#8220;/realHTML4Natural/env1/...&#8221; would call the configuration under the &#8220;environment&#8221; tag with the type &#8220;env1&#8221;.</p>
</div>
<div class="section" id="explanation-enviroment-childs">
<h3>Explanation enviroment childs<a class="headerlink" href="#explanation-enviroment-childs" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="73%" />
<col width="11%" />
<col width="7%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">entry</th>
<th class="head">explanation</th>
<th class="head">default Value</th>
<th class="head">required</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>routes</td>
<td>the path to the routes configuration file</td>
<td>None</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>templates</td>
<td>the path to the template folder</td>
<td>None</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>natsourcepath</td>
<td>path to the Natural sources (must be the root directory of the natural source)</td>
<td>None</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>natparms</td>
<td>parameter that will be passed through to Natural (the same as if you were calling Natural from the binary)</td>
<td>None</td>
<td>no</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="routes-configuration">
<h2>Routes configuration<a class="headerlink" href="#routes-configuration" title="Permalink to this headline">¶</a></h2>
<p>In the route configuration file you enter the Natural program which should run when a specific route is called. This is the file that is specified in the &#8220;routes&#8221; tag in your <a class="reference internal" href="#connector-configuration">Connector configuration</a>.</p>
<div class="section" id="id2">
<h3>Example<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;realHtml&gt;</span>
    <span class="nt">&lt;route</span> <span class="na">path=</span><span class="s">&quot;/notizen&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;programm&gt;</span>SHNOTIZ<span class="nt">&lt;/programm&gt;</span>
        <span class="nt">&lt;library&gt;</span>TOMENGE<span class="nt">&lt;/library&gt;</span>
        <span class="nt">&lt;debug&gt;</span>true<span class="nt">&lt;/debug&gt;</span>
    <span class="nt">&lt;/route&gt;</span>
    <span class="nt">&lt;route</span> <span class="na">path=</span><span class="s">&quot;/new_notiz&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;programm&gt;</span>STNOTIZ<span class="nt">&lt;/programm&gt;</span>
        <span class="nt">&lt;library&gt;</span>TOMENGE<span class="nt">&lt;/library&gt;</span>
    <span class="nt">&lt;/route&gt;</span>
    <span class="nt">&lt;route</span> <span class="na">path=</span><span class="s">&quot;/delete_notiz&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;programm&gt;</span>SDENOTIZ<span class="nt">&lt;/programm&gt;</span>
        <span class="nt">&lt;library&gt;</span>TOMENGE<span class="nt">&lt;/library&gt;</span>
    <span class="nt">&lt;/route&gt;</span>
<span class="nt">&lt;/realHtml&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="route-tag">
<h3>Route tag<a class="headerlink" href="#route-tag" title="Permalink to this headline">¶</a></h3>
<p>The route tag takes exactly one parameter. The path attribute. That is the URL which is requested on the server after the &#8220;realHTML4Natural/&lt;enviroment&gt;&#8221; url.</p>
<p>For example: The URL &#8220;localhost:8080/realHTML4Natural/env1/notizen&#8221; would call the program SHNOTIZ in the library TOMENGE.</p>
</div>
<div class="section" id="explanation-route-childs">
<h3>Explanation route childs<a class="headerlink" href="#explanation-route-childs" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="72%" />
<col width="12%" />
<col width="8%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">entry</th>
<th class="head">explanation</th>
<th class="head">default Value</th>
<th class="head">required</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>program</td>
<td>the Natural subprogram that will be called</td>
<td>None</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>library</td>
<td>the library to logon</td>
<td>None</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>debug</td>
<td>create a logfile with the name &#8220;&lt;ldaname&gt;.log&#8221; in the /tmp directory</td>
<td>False</td>
<td>no</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tomcat Connector</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#tomcat-servlet">Tomcat Servlet</a></li>
<li><a class="reference internal" href="#servlet-library">Servlet Library</a></li>
<li><a class="reference internal" href="#jni-library">JNI library</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#connector-configuration">Connector configuration</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#explanation-enviroment-tag">Explanation enviroment tag</a></li>
<li><a class="reference internal" href="#explanation-enviroment-childs">Explanation enviroment childs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#routes-configuration">Routes configuration</a><ul>
<li><a class="reference internal" href="#id2">Example</a></li>
<li><a class="reference internal" href="#route-tag">Route tag</a></li>
<li><a class="reference internal" href="#explanation-route-childs">Explanation route childs</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="previous chapter">Build process and Installation</a></li>
      <li>Next: <a href="webserver.html" title="next chapter">Webserver</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/connector.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Tom Engemann.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/connector.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>